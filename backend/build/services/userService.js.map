{"version":3,"sources":["../../src/services/userService.js"],"names":["prisma","PrismaClient","signupUserByEmail","res","username","email","password","emailNormalized","trim","toLowerCase","usernameNormalized","argon2","hash","passwordHashed","user","create","data","createdUser","emailHandler","sendEmailSignup","resetPasswordLogin","findUnique","where","userRecord","status","json","error","verify","isCorrectPass","userJWT","id","newJWT","authService","generateJWT","userClientData","userClientCleaner"],"mappings":";;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;AAEA,IAAMA,MAAM,GAAG,IAAIC,oBAAJ,EAAf;;AAEO,IAAMC,iBAAiB;AAAA,2FAAG,iBAAOC,GAAP,EAAYC,QAAZ,EAAsBC,KAAtB,EAA6BC,QAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AACzBC,YAAAA,eADyB,GACPF,KAAK,CAACG,IAAN,GAAaC,WAAb,EADO;AAEzBC,YAAAA,kBAFyB,GAEJN,QAAQ,CAACI,IAAT,EAFI;AAAA;AAAA,mBAGFG,kBAAOC,IAAP,CAAYN,QAAZ,CAHE;;AAAA;AAGzBO,YAAAA,cAHyB;AAK/B;AAEMC,YAAAA,IAPyB,GAOlB;AACXV,cAAAA,QAAQ,EAAEM,kBADC;AAEXL,cAAAA,KAAK,EAAEE,eAFI;AAGXD,cAAAA,QAAQ,EAAEO;AAHC,aAPkB;AAAA;AAAA,mBAaLb,MAAM,CAACc,IAAP,CAAYC,MAAZ,CAAmB;AAAEC,cAAAA,IAAI,EAAEF;AAAR,aAAnB,CAbK;;AAAA;AAazBG,YAAAA,WAbyB;AAe/BC,YAAAA,YAAY,CAACC,eAAb,CAA6BT,kBAA7B,EAAiDH,eAAjD;AAf+B,6CAiBxBU,WAjBwB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAjBf,iBAAiB;AAAA;AAAA;AAAA,GAAvB;;;;AAoBA,IAAMkB,kBAAkB;AAAA,4FAAG,kBAAOjB,GAAP,EAAYE,KAAZ,EAAmBC,QAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACPN,MAAM,CAACc,IAAP,CAAYO,UAAZ,CAAuB;AAAEC,cAAAA,KAAK,EAAE;AAAEjB,gBAAAA,KAAK,EAALA;AAAF;AAAT,aAAvB,CADO;;AAAA;AAC1BkB,YAAAA,UAD0B;;AAAA,gBAG3BA,UAH2B;AAAA;AAAA;AAAA;;AAAA,8CAIvBpB,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,cAAAA,KAAK,EAAE;AAAT,aAArB,CAJuB;;AAAA;AAAA;AAAA,mBAMJf,kBAAOgB,MAAP,CAAcJ,UAAU,CAACjB,QAAzB,EAAmCA,QAAnC,CANI;;AAAA;AAM1BsB,YAAAA,aAN0B;;AAAA,gBAQ3BA,aAR2B;AAAA;AAAA;AAAA;;AAAA,8CASvBzB,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,cAAAA,KAAK,EAAE;AAAT,aAArB,CATuB;;AAAA;AAW1BG,YAAAA,OAX0B,GAWhB;AAAEf,cAAAA,IAAI,EAAE;AAAEgB,gBAAAA,EAAE,EAAEP,UAAU,CAACO;AAAjB;AAAR,aAXgB;AAa1BC,YAAAA,MAb0B,GAajBC,WAAW,CAACC,WAAZ,CAAwBJ,OAAxB,CAbiB;AAe1BK,YAAAA,cAf0B,GAeTF,WAAW,CAACG,iBAAZ,CAA8BZ,UAA9B,CAfS;AAAA,8CAiBzB,CAACQ,MAAD,EAASG,cAAT,CAjByB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAlBd,kBAAkB;AAAA;AAAA;AAAA,GAAxB","sourcesContent":["import { PrismaClient } from '@prisma/client';\r\nimport argon2 from 'argon2';\r\nimport * as emailHandler from '../handlers/emailHandler';\r\nimport * as authService from '../services/authService';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport const signupUserByEmail = async (res, username, email, password) => {\r\n  const emailNormalized = email.trim().toLowerCase();\r\n  const usernameNormalized = username.trim();\r\n  const passwordHashed = await argon2.hash(password);\r\n\r\n  // authService.validateEmail(res, emailNormalized);\r\n\r\n  const user = {\r\n    username: usernameNormalized,\r\n    email: emailNormalized,\r\n    password: passwordHashed\r\n  };\r\n\r\n  const createdUser = await prisma.user.create({ data: user });\r\n\r\n  emailHandler.sendEmailSignup(usernameNormalized, emailNormalized);\r\n\r\n  return createdUser;\r\n};\r\n\r\nexport const resetPasswordLogin = async (res, email, password) => {\r\n  const userRecord = await prisma.user.findUnique({ where: { email } });\r\n\r\n  if (!userRecord)\r\n    return res.status(401).json({ error: 'login.invalidCredentials' });\r\n\r\n  const isCorrectPass = await argon2.verify(userRecord.password, password);\r\n\r\n  if (!isCorrectPass)\r\n    return res.status(401).json({ error: 'login.invalidCredentials' });\r\n\r\n  const userJWT = { user: { id: userRecord.id } };\r\n\r\n  const newJWT = authService.generateJWT(userJWT);\r\n\r\n  const userClientData = authService.userClientCleaner(userRecord);\r\n\r\n  return [newJWT, userClientData];\r\n};\r\n"],"file":"userService.js"}