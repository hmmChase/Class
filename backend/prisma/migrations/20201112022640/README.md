# Migration `20201112022640`

This migration has been generated by Chase at 11/11/2020, 6:26:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('TEACHER', 'STUDENT')

CREATE TABLE "User" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),
    "email" TEXT NOT NULL,
    "username" TEXT NOT NULL,
    "password" TEXT,
    "avatarUrl" TEXT,
    "role" "Role" NOT NULL DEFAULT E'STUDENT',
    "hasDiscordLogin" BOOLEAN NOT NULL DEFAULT false,
    "resetPassToken" TEXT,
    "resetPassTokenExpiry" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "Challenge" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),
    "path" TEXT NOT NULL,
    "title" TEXT NOT NULL,
    "desc" TEXT NOT NULL,
    "videoUrl" TEXT NOT NULL,
    "author_id" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Project" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),
    "githubLink" TEXT NOT NULL,
    "additionalLink" TEXT,
    "comments" TEXT,
    "author_id" INTEGER NOT NULL,
    "challenge_Id" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Question" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),
    "title" TEXT NOT NULL,
    "body" TEXT NOT NULL,
    "author_id" INTEGER NOT NULL,
    "challenge_Id" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Comment" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),
    "body" TEXT NOT NULL,
    "isAnswer" BOOLEAN NOT NULL DEFAULT false,
    "author_id" INTEGER NOT NULL,
    "question_id" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "User.resetPassToken_unique" ON "User"("resetPassToken")

CREATE UNIQUE INDEX "Challenge.path_unique" ON "Challenge"("path")

ALTER TABLE "Challenge" ADD FOREIGN KEY("author_id")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Project" ADD FOREIGN KEY("author_id")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Project" ADD FOREIGN KEY("challenge_Id")REFERENCES "Challenge"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Question" ADD FOREIGN KEY("author_id")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Question" ADD FOREIGN KEY("challenge_Id")REFERENCES "Challenge"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("author_id")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("question_id")REFERENCES "Question"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201112022640
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,96 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+// Do this whenever this files changes:
+// npx prisma migrate save --experimental
+// npx prisma migrate up --experimental
+// npx prisma generate
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id                   Int         @id @default(autoincrement())
+  createdAt            DateTime    @default(now())
+  updatedAt            DateTime    @updatedAt
+  deletedAt            DateTime?
+  email                String      @unique
+  username             String
+  password             String?
+  avatarUrl            String?
+  role                 Role        @default(STUDENT)
+  hasDiscordLogin      Boolean     @default(false)
+  resetPassToken       String?     @unique
+  resetPassTokenExpiry DateTime?
+  challenges           Challenge[]
+  projects             Project[]
+  questions            Question[]
+  comments             Comment[]
+}
+
+enum Role {
+  TEACHER
+  STUDENT
+}
+
+model Challenge {
+  id        Int        @id @default(autoincrement())
+  createdAt DateTime   @default(now())
+  updatedAt DateTime   @updatedAt
+  deletedAt DateTime?
+  path      String     @unique
+  title     String
+  desc      String
+  videoUrl  String
+  projects  Project[]
+  questions Question[]
+  author    User       @relation(fields: [author_id], references: [id])
+  author_id Int
+}
+
+model Project {
+  id             Int       @id @default(autoincrement())
+  createdAt      DateTime  @default(now())
+  updatedAt      DateTime  @updatedAt
+  deletedAt      DateTime?
+  githubLink     String
+  additionalLink String?
+  comments       String?
+  author         User      @relation(fields: [author_id], references: [id])
+  author_id      Int
+  challenge      Challenge @relation(fields: [challenge_Id], references: [id])
+  challenge_Id   Int
+}
+
+model Question {
+  id           Int       @id @default(autoincrement())
+  createdAt    DateTime  @default(now())
+  updatedAt    DateTime  @updatedAt
+  deletedAt    DateTime?
+  title        String
+  body         String
+  comments     Comment[]
+  author       User      @relation(fields: [author_id], references: [id])
+  author_id    Int
+  challenge    Challenge @relation(fields: [challenge_Id], references: [id])
+  challenge_Id Int
+}
+
+model Comment {
+  id          Int       @id @default(autoincrement())
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @updatedAt
+  deletedAt   DateTime?
+  body        String
+  isAnswer    Boolean   @default(false)
+  author      User      @relation(fields: [author_id], references: [id])
+  author_id   Int
+  question    Question  @relation(fields: [question_id], references: [id])
+  question_id Int
+}
```


